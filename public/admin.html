<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beige | Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#faf6f0',
                            100: '#f5ede1',
                            200: '#ebdbc3',
                            300: '#dfc39d',
                            400: '#d2a16d',
                            500: '#c8854a',
                            600: '#ba6f3f',
                            700: '#9b5835',
                            800: '#7d4730',
                            900: '#663b29',
                            950: '#361e15',
                        },
                        secondary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .sidebar {
            transition: width 0.3s ease, box-shadow 0.3s ease;
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 1px 0 10px rgba(0, 0, 0, 0.05);
        }
        .sidebar-collapsed {
            width: 60px;
        }
        .sidebar-collapsed .sidebar-text {
            display: none;
        }
        .sidebar-collapsed .logo-text {
            display: none;
        }
        .sidebar-collapsed .nav-item {
            justify-content: center;
        }
        .content-area {
            transition: margin-left 0.3s ease;
            background-color: #f8fafc;
        }
        .content-expanded {
            margin-left: 60px;
        }
        .card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: cardEnter 0.4s ease-out forwards;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .modal {
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .modal-enter {
            opacity: 0;
            transform: translateY(-20px);
        }
        .modal-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
        .modal-exit {
            opacity: 1;
            transform: translateY(0);
        }
        .modal-exit-active {
            opacity: 0;
            transform: translateY(-20px);
        }
        .alert {
            animation: slideIn 0.3s ease-out;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .chart-container {
            height: 240px;
        }
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .data-table th, .data-table td {
            padding: 0.5rem 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.75rem;
        }
        .data-table th {
            background-color: #f1f5f9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
        }
        .data-table tr:hover td {
            background-color: #f8fafc;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.6875rem;
            font-weight: 500;
        }
        .badge-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        .badge-reviewed {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .badge-confirmed {
            background-color: #d1fae5;
            color: #065f46;
        }
        .badge-cancelled {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .form-input {
            border: 1px solid #e2e8f0;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            width: 100%;
            font-size: 0.8125rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #c8854a;
            box-shadow: 0 0 0 3px rgba(200, 133, 74, 0.2);
        }
        .form-button {
            background-color: #c8854a;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .form-button:hover {
            background-color: #ba6f3f;
            transform: translateY(-1px);
        }
        .form-button:disabled {
            background-color: #e2e8f0;
            cursor: not-allowed;
            transform: none;
        }
        .spinner {
            display: inline-block;
            width: 0.875rem;
            height: 0.875rem;
            border: 2px solid #c8854a;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover:after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1e293b;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            margin-bottom: 6px;
        }
        header {
            background: linear-gradient(90deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 1px 8px rgba(0, 0, 0, 0.05);
        }
        .nav-item {
            border-radius: 6px;
            margin: 0 6px;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
        }
        .nav-item:hover {
            transform: translateX(3px);
        }
        .nav-item.active {
            background-color: #faf6f0;
            color: #c8854a;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Mobile Block Modal -->
    <div id="mobile-block-modal" class="block sm:hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm mx-4 p-6 text-center">
            <h3 class="text-base font-semibold text-gray-900 mb-2">Please Use a PC</h3>
            <p class="text-sm text-gray-700">
                We're sorry, but the Admin Dashboard is not available on mobile devices. For the best experience and full functionality, please access this page using a desktop or laptop computer.
            </p>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar fixed top-0 left-0 h-screen bg-white shadow-md z-50 w-56 flex flex-col hidden sm:flex">
        <div class="p-3 flex items-center justify-between border-b border-gray-200">
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold text-sm">
                    B
                </div>
                <span class="logo-text ml-2 text-lg font-semibold">Beige Admin</span>
            </div>
            <button id="sidebar-toggle" class="text-gray-500 hover:text-gray-700" aria-label="Toggle Sidebar">
                <i class="fas fa-bars text-sm"></i>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto py-3">
            <nav>
                <div class="px-3 mb-3">
                    <p class="sidebar-text text-xs font-semibold text-gray-500 uppercase tracking-wider">Dashboard</p>
                </div>
                <ul>
                    <li>
                        <a href="admin.html" data-section="overview-section" class="nav-item flex items-center px-3 py-2 text-gray-700 bg-primary-50 text-primary-600 active">
                            <i class="fas fa-tachometer-alt w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Overview</span>
                        </a>
                    </li>
                    <li>
                        <a href="manage-models.html" data-section="models-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-users w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Models</span>
                        </a>
                    </li>
                    <li>
                        <a href="manage-bookings.html" data-section="bookings-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-calendar-check w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Bookings</span>
                        </a>
                    </li>
                    <li>
                        <a href="manage-applications.html" data-section="applications-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-envelope w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Applications</span>
                        </a>
                    </li>
                </ul>
                <div class="px-3 mt-4 mb-3">
                    <p class="sidebar-text text-xs font-semibold text-gray-500 uppercase tracking-wider">Content</p>
                </div>
                <ul>
                    <li>
                        <a href="manage-about-companies.html" data-section="team-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-user-tie w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">About & Companies</span>
                        </a>
                    </li>
                    <li>
                        <a href="manage-team-members.html" data-section="team-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-user-tie w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Team</span>
                        </a>
                    </li>
                    <li>
                        <a href="manage-newsletter-subscribers.html" data-section="newsletter-section" class="nav-item flex items-center px-3 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                            <i class="fas fa-newspaper w-5 text-center"></i>
                            <span class="sidebar-text ml-2 text-sm">Newsletter</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <!-- Message Modal -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
                <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                    <h3 id="message-modal-title" class="text-base font-semibold text-gray-900">New Notification</h3>
                    <button id="close-message-modal" class="text-gray-500 hover:text-gray-700" aria-label="Close Message Modal">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
                <div class="p-4">
                    <p id="message-modal-content" class="text-sm text-gray-700"></p>
                    <div class="mt-4 flex justify-end">
                        <button id="message-modal-navigate" class="form-button">View Details</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Offline Notification -->
        <div id="offline-alert" class="fixed top-3 right-3 z-50 hidden">
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 alert">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-circle text-yellow-500 text-sm"></i>
                    </div>
                    <div class="ml-2">
                        <p class="text-xs font-medium text-yellow-700">
                            No Internet Connection. Retrying in <span id="countdown-timer">5</span>s...
                        </p>
                    </div>
                    <div class="ml-auto pl-2">
                        <button id="retry-now" class="text-yellow-500 hover:text-yellow-700 text-xs font-medium">
                            Retry Now
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-3 border-t border-gray-200 flex items-center">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                <i class="fas fa-user text-gray-500 text-sm"></i>
            </div>
            <div class="sidebar-text ml-2">
                <p class="text-sm font-medium">Admin User</p>
                <p class="text-xs text-gray-500">Super Admin</p>
            </div>
            <button id="logout-btn" class="sidebar-text ml-auto text-gray-500 hover:text-gray-700" aria-label="Logout">
                <i class="fas fa-sign-out-alt text-sm"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-area ml-56 min-h-screen hidden sm:block">
        <!-- Top Navigation -->
        <header class="bg-white shadow-sm py-3 px-4 flex items-center justify-between sticky top-0 z-40">
            <div class="flex items-center">
                <h1 class="text-lg font-bold text-gray-900" id="dashboard-title">Overview</h1>
            </div>
            <div class="flex items-center space-x-3">
                <!-- Notification Button with Red Counter -->
                <button id="messages-button" class="relative w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors" aria-label="Messages">
                    <i class="fas fa-bell text-sm"></i>
                    <span id="pending-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-medium rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                </button>
                <div class="relative">
                    <button id="user-menu-button" class="flex items-center space-x-1 focus:outline-none" aria-label="User Menu">
                        <div class="w-6 h-6 rounded-full bg-primary-500 flex items-center justify-center text-white font-medium text-xs">
                            A
                        </div>
                        <span class="hidden md:inline-block text-sm font-medium">Admin User</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div id="user-menu" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-lg shadow-lg py-1 z-50">
                        <a href="#" class="block px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50 hover:text-primary-600 transition-colors">Your Profile</a>
                        <a href="#" class="block px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50 hover:text-primary-600 transition-colors">Settings</a>
                        <a href="#" id="menu-logout" class="block px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50 hover:text-primary-600 transition-colors">Sign out</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Content -->
        <main class="p-4" id="dashboard-content">
            <!-- Dashboard -->
            <div id="dashboard" class="hidden">
                <!-- Overview Section -->
                <div id="overview-section">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div class="card p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs font-medium text-gray-500">Total Models</p>
                                    <h3 id="total-models" class="text-xl font-bold mt-1">0</h3>
                                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i> 12% from last month</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-primary-50 flex items-center justify-center text-primary-500">
                                    <i class="fas fa-users text-base"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs font-medium text-gray-500">Active Bookings</p>
                                    <h3 id="active-bookings" class="text-xl font-bold mt-1">0</h3>
                                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i> 5% from last week</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-500">
                                    <i class="fas fa-calendar-check text-base"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs font-medium text-gray-500">Pending Applications</p>
                                    <h3 id="pending-applications" class="text-xl font-bold mt-1">0</h3>
                                    <p class="text-xs text-red-500 mt-1"><i class="fas fa-arrow-down mr-1"></i> 3% from last week</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-yellow-50 flex items-center justify-center text-yellow-500">
                                    <i class="fas fa-envelope text-base"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs font-medium text-gray-500">Newsletter Subscribers</p>
                                    <h3 id="newsletter-subscribers" class="text-xl font-bold mt-1">0</h3>
                                    <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i> 8% from last month</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-purple-50 flex items-center justify-center text-purple-500">
                                    <i class="fas fa-newspaper text-base"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                        <div class="card p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-base font-semibold">Bookings Overview</h3>
                                <div class="flex space-x-2">
                                    <button class="px-2 py-1 text-xs bg-gray-100 rounded-md hover:bg-gray-200">Week</button>
                                    <button class="px-2 py-1 text-xs bg-primary-100 text-primary-600 rounded-md">Month</button>
                                    <button class="px-2 py-1 text-xs bg-gray-100 rounded-md hover:bg-gray-200">Year</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="bookingsChart"></canvas>
                            </div>
                        </div>
                        <div class="card p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-base font-semibold">Model Categories</h3>
                                <div class="flex space-x-2">
                                    <button class="px-2 py-1 text-xs bg-gray-100 rounded-md hover:bg-gray-200">By Count</button>
                                    <button class="px-2 py-1 text-xs bg-primary-100 text-primary-600 rounded-md">By Revenue</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="categoriesChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Bookings Section -->
                    <div id="bookings-section" class="card mb-4">
                        <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-base font-semibold">Recent Bookings</h3>
                            <a href="manage-bookings.html" class="text-xs text-primary-600 hover:text-primary-800">View All</a>
                        </div>
                        <div id="booking-loading" class="text-center text-xs py-3 hidden">
                            <span class="spinner"></span> Loading...
                        </div>
                        <p id="booking-error" class="text-red-500 text-xs px-4 py-2 hidden"></p>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Client</th>
                                        <th>Model</th>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="booking-grid"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Latest Applications Section -->
                    <div id="applications-section" class="card">
                        <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-base font-semibold">Latest Applications</h3>
                            <a href="manage-applications.html" class="text-xs text-primary-600 hover:text-primary-800">View All</a>
                        </div>
                        <div id="application-loading" class="text-center text-xs py-3 hidden">
                            <span class="spinner"></span> Loading...
                        </div>
                        <p id="application-error" class="text-red-500 text-xs px-4 py-2 hidden"></p>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Category</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="application-grid"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div id="login-section" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
            <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                <h3 class="text-base font-semibold text-gray-900">Admin Login</h3>
                <button id="close-login-modal" class="text-gray-500 hover:text-gray-700" aria-label="Close Modal">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="login-form" class="space-y-3">
                    <div>
                        <label for="username" class="block text-xs font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" placeholder="Username" class="form-input" aria-label="Username">
                    </div>
                    <div>
                        <label for="password" class="block text-xs font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" placeholder="Password" class="form-input" aria-label="Password">
                    </div>
                    <button type="submit" class="form-button w-full">Login</button>
                </form>
                <p id="login-error" class="text-red-500 text-xs mt-2 hidden">Invalid credentials</p>
            </div>
        </div>
    </div>

    <!-- Success Alert -->
    <div id="success-alert" class="fixed top-3 right-3 z-50 hidden">
        <div class="bg-green-50 border-l-4 border-green-500 p-3">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-check-circle text-green-500 text-sm"></i>
                </div>
                <div class="ml-2">
                    <p id="success-message" class="text-xs font-medium text-green-700">Action completed successfully!</p>
                </div>
                <div class="ml-auto pl-2">
                    <button id="close-success-alert" class="text-green-500 hover:text-green-700" aria-label="Close Success Alert">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Alert -->
    <div id="error-alert" class="fixed top-3 right-3 z-50 hidden">
        <div class="bg-red-50 border-l-4 border-red-500 p-3">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-500 text-sm"></i>
                </div>
                <div class="ml-2">
                    <p id="error-message" class="text-xs font-medium text-red-700">An error occurred.</p>
                </div>
                <div class="ml-auto pl-2">
                    <button id="close-error-alert" class="text-red-500 hover:text-red-700" aria-label="Close Error Alert">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
            <div class="p-4">
                <div class="flex items-center justify-center w-10 h-10 mx-auto bg-red-100 rounded-full">
                    <i class="fas fa-exclamation text-red-600 text-base"></i>
                </div>
                <div class="mt-2 text-center">
                    <h3 id="confirmation-title" class="text-base font-semibold text-gray-900">Confirm Action</h3>
                    <div class="mt-1">
                        <p id="confirmation-message" class="text-xs text-gray-500">Are you sure you want to perform this action?</p>
                    </div>
                </div>
            </div>
            <div class="px-4 py-2 sm:flex sm:flex-row-reverse">
                <button id="confirm-action" type="button" class="px-3 py-1.5 rounded-md border border-transparent shadow-sm bg-red-600 text-xs font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-2">Confirm</button>
                <button id="cancel-action" type="button" class="mt-2 sm:mt-0 px-3 py-1.5 rounded-md border border-gray-300 shadow-sm bg-white text-xs font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">Cancel</button>
            </div>
        </div>
    </div>

<script>
    let bookingsChartInstance = null;
    let categoriesChartInstance = null;
    let pendingItems = []; // Global variable to track pending items
    let countdownInterval = null;
    let retryInterval = 5; // Start with 5 seconds
    const maxInterval = 18000; // 5 hours in seconds
    let retryAttempt = 0;

    function decodeToken(token) {
        if (!token) {
            console.error('No token provided for decoding');
            return false;
        }
        try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            console.log('Token payload:', payload);
            const exp = payload.exp * 1000;
            const now = Date.now();
            console.log('Token expires at:', new Date(exp).toLocaleString());
            console.log('Current time:', new Date(now).toLocaleString());
            return exp > now;
        } catch (error) {
            console.error('Error decoding token:', error);
            return false;
        }
    }

    const token = localStorage.getItem('token');
    const loginSection = document.getElementById('login-section');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const bookingError = document.getElementById('booking-error');
    const bookingLoading = document.getElementById('booking-loading');
    const applicationError = document.getElementById('application-error');
    const applicationLoading = document.getElementById('application-loading');
    const dashboardTitle = document.getElementById('dashboard-title');
    const navItems = document.querySelectorAll('.nav-item');
    const sections = document.querySelectorAll('#dashboard-content > div[id$="-section"]');

    // Sidebar toggle functionality
    const sidebar = document.querySelector('.sidebar');
    const contentArea = document.querySelector('.content-area');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('sidebar-collapsed');
            contentArea.classList.toggle('content-expanded');
        });
    }

    // User menu toggle
    const userMenuButton = document.getElementById('user-menu-button');
    const userMenu = document.getElementById('user-menu');
    if (userMenuButton) {
        userMenuButton.addEventListener('click', () => {
            userMenu.classList.toggle('hidden');
        });
    }

    // Section navigation
    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            const href = item.getAttribute('href');
            const sectionId = item.getAttribute('data-section');
            if (href === '#' && sectionId) {
                e.preventDefault();
                sections.forEach(section => {
                    section.classList.add('hidden');
                    if (section.id === sectionId) {
                        section.classList.remove('hidden');
                        if (dashboardTitle) {
                            dashboardTitle.textContent = item.querySelector('.sidebar-text').textContent;
                        }
                    }
                });
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
            }
        });
    });

    function checkOnlineStatus() {
        return navigator.onLine;
    }

    function showOfflineAlert() {
        const offlineAlert = document.getElementById('offline-alert');
        const countdownTimer = document.getElementById('countdown-timer');
        let countdown = retryInterval;

        if (offlineAlert && countdownTimer) {
            offlineAlert.classList.remove('hidden');
            offlineAlert.classList.add('slideIn');
            countdownTimer.textContent = countdown;

            // Start countdown
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                countdown--;
                countdownTimer.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    attemptReconnect();
                }
            }, 1000);
        }
    }

    function hideOfflineAlert() {
        const offlineAlert = document.getElementById('offline-alert');
        if (offlineAlert) {
            offlineAlert.classList.add('hidden');
            clearInterval(countdownInterval);
        }
    }

    async function attemptReconnect() {
        try {
            await fetch('/api/ping', { method: 'HEAD', cache: 'no-store' });
            hideOfflineAlert();
            window.location.reload();
        } catch (error) {
            console.error('Reconnect attempt failed:', error);
            retryAttempt++;
            retryInterval = Math.min(retryInterval * 2, maxInterval);
            if (retryInterval >= maxInterval) {
                console.log('Max retry interval reached (5 hours). Stopping retries.');
                hideOfflineAlert();
                const errorMessage = document.getElementById('error-message');
                if (errorMessage) {
                    errorMessage.textContent = 'No internet after 5 hours. Please check your connection.';
                    document.getElementById('error-alert').classList.remove('hidden');
                }
                return;
            }
            showOfflineAlert();
        }
    }

    window.addEventListener('offline', () => {
        console.log('Internet connection lost');
        retryInterval = 5;
        retryAttempt = 0;
        showOfflineAlert();
    });

    window.addEventListener('online', () => {
        console.log('Internet connection restored');
        hideOfflineAlert();
        retryInterval = 5;
        retryAttempt = 0;
        window.location.reload();
    });

    const retryNowButton = document.getElementById('retry-now');
    if (retryNowButton) {
        retryNowButton.addEventListener('click', attemptReconnect);
    }

    if (!checkOnlineStatus()) {
        showOfflineAlert();
    }

    // Modal controls
    const closeLoginModal = document.getElementById('close-login-modal');
    function closeModal() {
        if (loginSection) {
            loginSection.classList.add('modal-exit-active');
            setTimeout(() => {
                loginSection.classList.add('hidden');
                loginSection.classList.remove('modal-exit-active');
                if (loginError) loginError.classList.add('hidden');
                if (loginForm) loginForm.reset();
            }, 200);
        }
    }

    if (closeLoginModal) {
        closeLoginModal.addEventListener('click', closeModal);
    }

    // Close login modal on outside click or Escape key
    if (loginSection) {
        loginSection.addEventListener('click', (e) => {
            if (e.target === loginSection) {
                closeModal();
            }
        });

        loginSection.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    }

    // Initial token check
    function initializeLoginState() {
        if (!token) {
            console.log('No token found in localStorage');
            loginSection.classList.remove('hidden');
            loginSection.classList.add('modal-enter-active');
            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
            dashboard.classList.add('hidden');
            if (loginError) {
                loginError.textContent = 'No session found. Please log in.';
                loginError.classList.remove('hidden');
            }
        } else if (decodeToken(token)) {
            console.log('Token is valid');
            loginSection.classList.add('hidden');
            dashboard.classList.remove('hidden');
            loadDashboard();
        } else {
            console.log('Token is expired or invalid');
            localStorage.removeItem('token');
            loginSection.classList.remove('hidden');
            loginSection.classList.add('modal-enter-active');
            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
            dashboard.classList.add('hidden');
            if (loginError) {
                loginError.textContent = 'Session expired. Please log in again.';
                loginError.classList.remove('hidden');
            }
        }
    }

    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            console.log('Logging out, clearing token');
            localStorage.removeItem('token');
            loginSection.classList.remove('hidden');
            loginSection.classList.add('modal-enter-active');
            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
            dashboard.classList.add('hidden');
            if (loginError) loginError.classList.add('hidden');
            if (loginForm) loginForm.reset();
        });
    }

    const menuLogout = document.getElementById('menu-logout');
    if (menuLogout) {
        menuLogout.addEventListener('click', (e) => {
            e.preventDefault();
            console.log('Logging out via menu, clearing token');
            localStorage.removeItem('token');
            loginSection.classList.remove('hidden');
            loginSection.classList.add('modal-enter-active');
            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
            dashboard.classList.add('hidden');
            if (loginError) loginError.classList.add('hidden');
            if (loginForm) loginForm.reset();
            userMenu.classList.add('hidden');
        });
    }

    if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = loginForm.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner"></span> Logging in...';
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            if (!username || !password) {
                if (loginError) {
                    loginError.textContent = 'Username and password are required';
                    loginError.classList.remove('hidden');
                }
                submitButton.disabled = false;
                submitButton.innerHTML = 'Login';
                return;
            }
            try {
                console.log('Sending login request:', { username });
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                console.log('Login response:', data);
                if (response.ok) {
                    if (typeof data.token !== 'string') {
                        console.error('Received invalid token:', data.token);
                        if (loginError) {
                            loginError.textContent = 'Invalid token received from server';
                            loginError.classList.remove('hidden');
                        }
                        submitButton.disabled = false;
                        submitButton.innerHTML = 'Login';
                        return;
                    }
                    console.log('Storing token:', data.token);
                    localStorage.setItem('token', data.token);
                    console.log('Stored token:', localStorage.getItem('token'));
                    closeModal();
                    dashboard.classList.remove('hidden');
                    loadDashboard();
                } else {
                    if (loginError) {
                        loginError.textContent = data.message || 'Invalid credentials';
                        loginError.classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                if (loginError) {
                    loginError.textContent = 'Server error';
                    loginError.classList.remove('hidden');
                }
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = 'Login';
            }
        });
    }

    async function loadDashboard() {
        pendingItems = [];
        await Promise.all([
            loadBookings(),
            loadApplications(),
            updateStats()
        ]);
        updatePendingMessages();
    }

    async function updateStats() {
        try {
            const token = localStorage.getItem('token');
            if (!token) throw new Error('No token found in localStorage');

            const modelsResponse = await fetch('/api/models?page=1&limit=1', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const modelsData = await modelsResponse.json();
            const totalModelsElement = document.getElementById('total-models');
            if (totalModelsElement) totalModelsElement.textContent = modelsData.total || 0;

            const bookingsResponse = await fetch('/api/bookings?status=confirmed', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const bookingsData = await bookingsResponse.json();
            const activeBookingsElement = document.getElementById('active-bookings');
            if (activeBookingsElement) activeBookingsElement.textContent = bookingsData.length || 0;

            const applicationsResponse = await fetch('/api/applications?status=pending', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const applicationsData = await applicationsResponse.json();
            const pendingApplicationsElement = document.getElementById('pending-applications');
            if (pendingApplicationsElement) pendingApplicationsElement.textContent = applicationsData.length || 0;

            const subscribersResponse = await fetch('/api/newsletter', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const subscribersData = await subscribersResponse.json();
            const newsletterSubscribersElement = document.getElementById('newsletter-subscribers');
            if (newsletterSubscribersElement) newsletterSubscribersElement.textContent = subscribersData.length || 0;

            await updateBookingsChart('month');
            await updateCategoriesChart('revenue');
        } catch (error) {
            console.error('Error updating stats:', error);
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = 'Error loading dashboard stats';
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
        }
    }

    async function updateBookingsChart(timeframe) {
        try {
            const token = localStorage.getItem('token');
            if (!token) throw new Error('No token found');

            const bookingsChartContainer = document.getElementById('bookingsChart').parentElement;
            bookingsChartContainer.innerHTML = '<div class="text-center text-xs py-3"><span class="spinner"></span> Loading...</div>';

            const response = await fetch(`/api/bookings?timeframe=${timeframe}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (!response.ok) {
                const data = await response.json();
                throw new Error(data.message || `HTTP error: ${response.status}`);
            }
            const bookings = await response.json();
            console.log('Bookings data:', bookings);

            const { labels, data } = aggregateBookingsData(bookings, timeframe);
            console.log('Bookings chart data:', { labels, data });

            bookingsChartContainer.innerHTML = '<canvas id="bookingsChart"></canvas>';

            if (bookingsChartInstance) {
                bookingsChartInstance.data.labels = labels;
                bookingsChartInstance.data.datasets[0].data = data;
                bookingsChartInstance.update();
            } else {
                bookingsChartInstance = new Chart(document.getElementById('bookingsChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Bookings',
                            data,
                            borderColor: '#c8854a',
                            backgroundColor: 'rgba(200, 133, 74, 0.2)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        } catch (error) {
            console.error('Error updating bookings chart:', error);
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = 'Error loading bookings chart';
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
            const bookingsChartContainer = document.getElementById('bookingsChart').parentElement;
            bookingsChartContainer.innerHTML = '<canvas id="bookingsChart"></canvas>';
        }
    }

    async function updateCategoriesChart(metric) {
        try {
            const token = localStorage.getItem('token');
            if (!token) throw new Error('No token found');

            const categoriesChartContainer = document.getElementById('categoriesChart').parentElement;
            categoriesChartContainer.innerHTML = '<div class="text-center text-xs py-3"><span class="spinner"></span> Loading...</div>';

            let labels, data;
            if (metric === 'count') {
                const response = await fetch('/api/models', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const models = await response.json();
                console.log('Raw models data:', JSON.stringify(models, null, 2));
                ({ labels, data } = aggregateModelCategories(models));
            } else {
                const response = await fetch('/api/bookings', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const bookings = await response.json();
                console.log('Raw bookings data for revenue:', JSON.stringify(bookings, null, 2));
                ({ labels, data } = aggregateCategoryRevenue(bookings));
            }
            console.log('Categories chart data:', { labels, data });

            if (!labels.length || !data.length) {
                console.warn('Empty labels or data, using fallback');
                labels = ['No Data'];
                data = [1];
            } else if (data.some(val => isNaN(val) || val === null || val === undefined)) {
                console.warn('Invalid data values, filtering out');
                const validPairs = labels.reduce((acc, label, i) => {
                    if (!isNaN(data[i]) && data[i] !== null && data[i] !== undefined) {
                        acc.labels.push(label);
                        acc.data.push(Math.max(data[i], 0.1));
                    }
                    return acc;
                }, { labels: [], data: [] });
                labels = validPairs.labels.length ? validPairs.labels : ['No Data'];
                data = validPairs.data.length ? validPairs.data : [1];
            }

            categoriesChartContainer.innerHTML = '<canvas id="categoriesChart"></canvas>';

            const canvas = document.getElementById('categoriesChart');
            canvas.style.display = 'block';
            canvas.style.width = '100%';
            canvas.style.height = '240px';

            if (categoriesChartInstance) {
                categoriesChartInstance.destroy();
                categoriesChartInstance = null;
            }

            categoriesChartInstance = new Chart(canvas.getContext('2d'), {
                type: 'pie',
                data: {
                    labels,
                    datasets: [{
                        data,
                        backgroundColor: ['#c8854a', '#ba6f3f', '#9b5835', '#7d4730', '#663b29', '#f5ede1', '#ebdbc3', '#dfc39d', '#d2a16d'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
            console.log('Pie chart initialized:', categoriesChartInstance);
        } catch (error) {
            console.error('Error updating categories chart:', error);
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = 'Error loading categories chart';
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
            const categoriesChartContainer = document.getElementById('categoriesChart').parentElement;
            categoriesChartContainer.innerHTML = '<canvas id="categoriesChart"></canvas>';
        }
    }

    function aggregateBookingsData(bookings, timeframe) {
        let labels = [];
        let data = [];

        if (timeframe === 'week') {
            labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            data = new Array(7).fill(0);
            bookings.forEach(booking => {
                const date = new Date(booking.bookingDateTime);
                if (!isNaN(date.getTime())) {
                    const day = date.getDay();
                    data[day === 0 ? 6 : day - 1]++;
                }
            });
        } else if (timeframe === 'month') {
            labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            data = new Array(4).fill(0);
            bookings.forEach(booking => {
                const date = new Date(booking.bookingDateTime);
                if (!isNaN(date.getTime())) {
                    const week = Math.floor(date.getDate() / 7);
                    data[week]++;
                }
            });
        } else if (timeframe === 'year') {
            labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            data = new Array(12).fill(0);
            bookings.forEach(booking => {
                const date = new Date(booking.bookingDateTime);
                if (!isNaN(date.getTime())) {
                    const month = date.getMonth();
                    data[month]++;
                }
            });
        }

        console.log('Bookings aggregation result:', { labels, data });
        if (data.every(val => val === 0)) {
            console.warn('All bookings data is zero, returning minimal data');
            return { labels, data: new Array(labels.length).fill(0.1) };
        }

        return { labels, data };
    }

    function aggregateModelCategories(models) {
        console.log('Aggregating model categories, input:', JSON.stringify(models, null, 2));
        const categoryCounts = {};
        (Array.isArray(models) ? models : []).forEach(model => {
            const category = model && typeof model.category === 'string' ? model.category.trim() : 'Unknown';
            if (category) {
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            }
        });
        const labels = Object.keys(categoryCounts).length ? Object.keys(categoryCounts) : ['No Data'];
        const data = Object.values(categoryCounts).length ? Object.values(categoryCounts) : [1];
        console.log('Model categories aggregated:', { labels, data });
        return { labels, data };
    }

    function aggregateCategoryRevenue(bookings) {
        console.log('Aggregating category revenue, input:', JSON.stringify(bookings, null, 2));
        const categoryRevenue = {};
        (Array.isArray(bookings) ? bookings : []).forEach(booking => {
            const category = booking && typeof booking.shootType === 'string' ? booking.shootType.trim() : 'Unknown';
            const revenue = Number(booking && booking.revenue) || 0;
            if (category) {
                categoryRevenue[category] = (categoryRevenue[category] || 0) + revenue;
            }
        });
        const labels = Object.keys(categoryRevenue).length ? Object.keys(categoryRevenue) : ['No Data'];
        const data = Object.values(categoryRevenue).length ? Object.values(categoryRevenue).map(val => Math.max(val, 0.1)) : [1];
        console.log('Category revenue aggregated:', { labels, data });
        return { labels, data };
    }

    const timeframeButtons = document.querySelectorAll('#bookingsChart ~ div.flex.space-x-2 button');
    console.log('Found timeframe buttons:', timeframeButtons.length);
    timeframeButtons.forEach(button => {
        button.addEventListener('click', async () => {
            console.log('Timeframe button clicked:', button.textContent);
            timeframeButtons.forEach(btn => btn.classList.remove('bg-primary-100', 'text-primary-600'));
            button.classList.add('bg-primary-100', 'text-primary-600');
            const timeframe = button.textContent.toLowerCase();
            await updateBookingsChart(timeframe);
        });
    });

    const categoryButtons = document.querySelectorAll('#categoriesChart ~ div.flex.space-x-2 button');
    console.log('Found category buttons:', categoryButtons.length);
    categoryButtons.forEach(button => {
        button.addEventListener('click', async () => {
            console.log('Category button clicked:', button.textContent);
            categoryButtons.forEach(btn => btn.classList.remove('bg-primary-100', 'text-primary-600'));
            button.classList.add('bg-primary-100', 'text-primary-600');
            const metric = button.textContent.toLowerCase().includes('count') ? 'count' : 'revenue';
            await updateCategoriesChart(metric);
        });
    });

    async function loadBookings() {
        if (bookingLoading) bookingLoading.classList.remove('hidden');
        if (bookingError) bookingError.classList.add('hidden');
        try {
            const token = localStorage.getItem('token');
            console.log('Sending request with token for bookings:', token);
            if (!token) {
                throw new Error('No token found in localStorage');
            }
            const response = await fetch('/api/bookings?limit=8&sort=-createdAt', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (!response.ok) {
                const data = await response.json().catch(() => ({}));
                if (response.status === 401) {
                    console.log('Unauthorized request, clearing token');
                    localStorage.removeItem('token');
                    loginSection.classList.remove('hidden');
                    loginSection.classList.add('modal-enter-active');
                    setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                    dashboard.classList.add('hidden');
                    if (loginError) {
                        loginError.textContent = 'Session expired. Please log in again.';
                        loginError.classList.remove('hidden');
                    }
                    return;
                }
                throw new Error(data.message || `HTTP error: ${response.status}`);
            }
            const bookings = await response.json();
            const bookingGrid = document.getElementById('booking-grid');
            if (bookingGrid) {
                bookingGrid.innerHTML = '';
                bookings.slice(0, 8).forEach(booking => {
                    if (booking.status === 'pending') {
                        pendingItems.push({
                            type: 'booking',
                            id: booking._id,
                            message: `New booking from ${booking.fullName || 'N/A'} for ${booking.shootType || 'N/A'} on ${booking.bookingDateTime ? new Date(booking.bookingDateTime).toLocaleString() : 'N/A'}`,
                            navigateUrl: 'manage-bookings.html'
                        });
                    }
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${booking.fullName || 'N/A'}</td>
                        <td>${booking.modelDetails || 'N/A'}</td>
                        <td>${booking.bookingDateTime ? new Date(booking.bookingDateTime).toLocaleString() : 'N/A'}</td>
                        <td>${booking.shootType || 'N/A'}</td>
                        <td><span class="badge badge-${booking.status}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                        <td>
                            <select id="status-${booking._id}" class="form-input px-2 py-1 text-xs" aria-label="Booking Status">
                                <option value="pending" ${booking.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="reviewed" ${booking.status === 'reviewed' ? 'selected' : ''}>Reviewed</option>
                                <option value="confirmed" ${booking.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                <option value="cancelled" ${booking.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                            </select>
                            <button onclick="updateBookingStatus('${booking._id}')" class="text-blue-500 hover:text-blue-700 ml-1 tooltip" data-tooltip="Save Status" aria-label="Save Booking Status">
                                <i class="fas fa-save text-xs"></i>
                            </button>
                            <button onclick="deleteBooking('${booking._id}')" class="text-red-500 hover:text-red-700 ml-1 tooltip" data-tooltip="Delete Booking" aria-label="Delete Booking">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </td>
                    `;
                    bookingGrid.appendChild(tr);
                });
            } else {
                console.error('Element with ID "booking-grid" not found');
            }
        } catch (error) {
            if (bookingError) {
                bookingError.textContent = error.message || 'Error loading bookings';
                bookingError.classList.remove('hidden');
            }
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = error.message;
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
        } finally {
            if (bookingLoading) bookingLoading.classList.add('hidden');
        }
    }

    async function loadApplications() {
        if (applicationLoading) applicationLoading.classList.remove('hidden');
        if (applicationError) applicationError.classList.add('hidden');
        try {
            const token = localStorage.getItem('token');
            console.log('Sending request with token for applications:', token);
            if (!token) {
                throw new Error('No token found in localStorage');
            }
            const response = await fetch('/api/applications?limit=8&sort=-submittedAt', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (!response.ok) {
                const data = await response.json().catch(() => ({}));
                if (response.status === 401) {
                    console.log('Unauthorized request, clearing token');
                    localStorage.removeItem('token');
                    loginSection.classList.remove('hidden');
                    loginSection.classList.add('modal-enter-active');
                    setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                    dashboard.classList.add('hidden');
                    if (loginError) {
                        loginError.textContent = 'Session expired. Please log in again.';
                        loginError.classList.remove('hidden');
                    }
                    return;
                }
                throw new Error(data.message || `HTTP error: ${response.status}`);
            }
            const applications = await response.json();
            const applicationGrid = document.getElementById('application-grid');
            if (applicationGrid) {
                applicationGrid.innerHTML = '';
                applications.slice(0, 8).forEach(application => {
                    if (application.status === 'pending') {
                        pendingItems.push({
                            type: 'application',
                            id: application._id,
                            message: `New application from ${application.fullName || 'N/A'} for ${application.category || 'N/A'} submitted on ${application.submittedAt ? new Date(application.submittedAt).toLocaleString() : 'N/A'}`,
                            navigateUrl: 'manage-applications.html'
                        });
                    }
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${application.fullName || 'N/A'}</td>
                        <td>${application.email || 'N/A'}</td>
                        <td>${application.category || 'N/A'}</td>
                        <td>${application.submittedAt ? new Date(application.submittedAt).toLocaleString() : 'N/A'}</td>
                        <td><span class="badge badge-${application.status}">${application.status.charAt(0).toUpperCase() + application.status.slice(1)}</span></td>
                        <td>
                            <select id="status-${application._id}" class="form-input px-2 py-1 text-xs" aria-label="Application Status">
                                <option value="pending" ${application.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="reviewed" ${application.status === 'reviewed' ? 'selected' : ''}>Reviewed</option>
                                <option value="confirmed" ${application.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                <option value="rejected" ${application.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                            </select>
                            <button onclick="updateApplicationStatus('${application._id}')" class="text-blue-500 hover:text-blue-700 ml-1 tooltip" data-tooltip="Save Status" aria-label="Save Application Status">
                                <i class="fas fa-save text-xs"></i>
                            </button>
                            <button onclick="deleteApplication('${application._id}')" class="text-red-500 hover:text-red-700 ml-1 tooltip" data-tooltip="Delete Application" aria-label="Delete Application">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </td>
                    `;
                    applicationGrid.appendChild(tr);
                });
            } else {
                console.error('Element with ID "application-grid" not found');
            }
        } catch (error) {
            if (applicationError) {
                applicationError.textContent = error.message || 'Error loading applications';
                applicationError.classList.remove('hidden');
            }
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = error.message;
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
        } finally {
            if (applicationLoading) applicationLoading.classList.add('hidden');
        }
    }

    async function updateBookingStatus(bookingId) {
        const select = document.getElementById(`status-${bookingId}`);
        const newStatus = select.value;
        const saveButton = select.nextElementSibling;
        saveButton.disabled = true;
        saveButton.innerHTML = '<span class="spinner"></span>';
        try {
            const token = localStorage.getItem('token');
            console.log('Updating booking status with token:', token);
            if (!token) {
                throw new Error('No token found in localStorage');
            }
            const response = await fetch(`/api/bookings/${bookingId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ status: newStatus })
            });
            if (!response.ok) {
                const data = await response.json();
                if (response.status === 401) {
                    console.log('Unauthorized request, clearing token');
                    localStorage.removeItem('token');
                    loginSection.classList.remove('hidden');
                    loginSection.classList.add('modal-enter-active');
                    setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                    dashboard.classList.add('hidden');
                    if (loginError) {
                        loginError.textContent = 'Session expired. Please log in again.';
                        loginError.classList.remove('hidden');
                    }
                    return;
                }
                throw new Error(data.message || 'Error updating booking status');
            }
            loadBookings();
            updateStats();
            const successMessage = document.getElementById('success-message');
            if (successMessage) {
                successMessage.textContent = 'Booking status updated successfully!';
                document.getElementById('success-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('success-alert').classList.add('hidden'), 3000);
            }
        } catch (error) {
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = error.message;
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
        } finally {
            saveButton.disabled = false;
            saveButton.innerHTML = '<i class="fas fa-save text-xs"></i>';
        }
    }

    async function deleteBooking(bookingId) {
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmButton = document.getElementById('confirm-action');
        const cancelButton = document.getElementById('cancel-action');
        const confirmationTitle = document.getElementById('confirmation-title');
        const confirmationMessage = document.getElementById('confirmation-message');
        if (confirmationTitle) confirmationTitle.textContent = 'Delete Booking';
        if (confirmationMessage) confirmationMessage.textContent = 'Are you sure you want to delete this booking? This action cannot be undone.';
        if (confirmationModal) {
            confirmationModal.classList.remove('hidden');
            confirmationModal.classList.add('modal-enter-active');
            setTimeout(() => confirmationModal.classList.remove('modal-enter-active'), 200);
        }

        if (confirmButton) {
            confirmButton.onclick = async () => {
                try {
                    const token = localStorage.getItem('token');
                    console.log('Deleting booking with token:', token);
                    if (!token) {
                        throw new Error('No token found in localStorage');
                    }
                    const response = await fetch(`/api/bookings/${bookingId}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) {
                        const data = await response.json();
                        if (response.status === 401) {
                            console.log('Unauthorized request, clearing token');
                            localStorage.removeItem('token');
                            loginSection.classList.remove('hidden');
                            loginSection.classList.add('modal-enter-active');
                            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                            dashboard.classList.add('hidden');
                            if (loginError) {
                                loginError.textContent = 'Session expired. Please log in again.';
                                loginError.classList.remove('hidden');
                            }
                            return;
                        }
                        throw new Error(data.message || 'Error deleting booking');
                    }
                    loadBookings();
                    updateStats();
                    const successMessage = document.getElementById('success-message');
                    if (successMessage) {
                        successMessage.textContent = 'Booking deleted successfully!';
                        document.getElementById('success-alert').classList.remove('hidden');
                        setTimeout(() => document.getElementById('success-alert').classList.add('hidden'), 3000);
                    }
                } catch (error) {
                    if (bookingError) {
                        bookingError.textContent = error.message;
                        bookingError.classList.remove('hidden');
                    }
                    const errorMessage = document.getElementById('error-message');
                    if (errorMessage) {
                        errorMessage.textContent = error.message;
                        document.getElementById('error-alert').classList.remove('hidden');
                        setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
                    }
                } finally {
                    if (confirmationModal) {
                        confirmationModal.classList.add('modal-exit-active');
                        setTimeout(() => {
                            confirmationModal.classList.add('hidden');
                            confirmationModal.classList.remove('modal-exit-active');
                        }, 200);
                    }
                }
            };
        }

        if (cancelButton) {
            cancelButton.onclick = () => {
                if (confirmationModal) {
                    confirmationModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        confirmationModal.classList.add('hidden');
                        confirmationModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            };
        }

        if (confirmationModal) {
            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    confirmationModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        confirmationModal.classList.add('hidden');
                        confirmationModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            });
        }
    }

    async function updateApplicationStatus(applicationId) {
        const select = document.getElementById(`status-${applicationId}`);
        const newStatus = select.value;
        const saveButton = select.nextElementSibling;
        saveButton.disabled = true;
        saveButton.innerHTML = '<span class="spinner"></span>';
        try {
            const token = localStorage.getItem('token');
            console.log('Updating application status with token:', token);
            if (!token) {
                throw new Error('No token found in localStorage');
            }
            const response = await fetch(`/api/applications/${applicationId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ status: newStatus })
            });
            if (!response.ok) {
                const data = await response.json();
                if (response.status === 401) {
                    console.log('Unauthorized request, clearing token');
                    localStorage.removeItem('token');
                    loginSection.classList.remove('hidden');
                    loginSection.classList.add('modal-enter-active');
                    setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                    dashboard.classList.add('hidden');
                    if (loginError) {
                        loginError.textContent = 'Session expired. Please log in again.';
                        loginError.classList.remove('hidden');
                    }
                    return;
                }
                throw new Error(data.message || 'Error updating application status');
            }
            loadApplications();
            updateStats();
            const successMessage = document.getElementById('success-message');
            if (successMessage) {
                successMessage.textContent = 'Application status updated successfully!';
                document.getElementById('success-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('success-alert').classList.add('hidden'), 3000);
            }
        } catch (error) {
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = error.message;
                document.getElementById('error-alert').classList.remove('hidden');
                setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
            }
        } finally {
            saveButton.disabled = false;
            saveButton.innerHTML = '<i class="fas fa-save text-xs"></i>';
        }
    }

    async function deleteApplication(applicationId) {
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmButton = document.getElementById('confirm-action');
        const cancelButton = document.getElementById('cancel-action');
        const confirmationTitle = document.getElementById('confirmation-title');
        const confirmationMessage = document.getElementById('confirmation-message');
        if (confirmationTitle) confirmationTitle.textContent = 'Delete Application';
        if (confirmationMessage) confirmationMessage.textContent = 'Are you sure you want to delete this application? This action cannot be undone.';
        if (confirmationModal) {
            confirmationModal.classList.remove('hidden');
            confirmationModal.classList.add('modal-enter-active');
            setTimeout(() => confirmationModal.classList.remove('modal-enter-active'), 200);
        }

        if (confirmButton) {
            confirmButton.onclick = async () => {
                try {
                    const token = localStorage.getItem('token');
                    console.log('Deleting application with token:', token);
                    if (!token) {
                        throw new Error('No token found in localStorage');
                    }
                    const response = await fetch(`/api/applications/${applicationId}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) {
                        const data = await response.json();
                        if (response.status === 401) {
                            console.log('Unauthorized request, clearing token');
                            localStorage.removeItem('token');
                            loginSection.classList.remove('hidden');
                            loginSection.classList.add('modal-enter-active');
                            setTimeout(() => loginSection.classList.remove('modal-enter-active'), 200);
                            dashboard.classList.add('hidden');
                            if (loginError) {
                                loginError.textContent = 'Session expired. Please log in again.';
                                loginError.classList.remove('hidden');
                            }
                            return;
                        }
                        throw new Error(data.message || 'Error deleting application');
                    }
                    loadApplications();
                    updateStats();
                    const successMessage = document.getElementById('success-message');
                    if (successMessage) {
                        successMessage.textContent = 'Application deleted successfully!';
                        document.getElementById('success-alert').classList.remove('hidden');
                        setTimeout(() => document.getElementById('success-alert').classList.add('hidden'), 3000);
                    }
                } catch (error) {
                    if (applicationError) {
                        applicationError.textContent = error.message;
                        applicationError.classList.remove('hidden');
                    }
                    const errorMessage = document.getElementById('error-message');
                    if (errorMessage) {
                        errorMessage.textContent = error.message;
                        document.getElementById('error-alert').classList.remove('hidden');
                        setTimeout(() => document.getElementById('error-alert').classList.add('hidden'), 3000);
                    }
                } finally {
                    if (confirmationModal) {
                        confirmationModal.classList.add('modal-exit-active');
                        setTimeout(() => {
                            confirmationModal.classList.add('hidden');
                            confirmationModal.classList.remove('modal-exit-active');
                        }, 200);
                    }
                }
            };
        }

        if (cancelButton) {
            cancelButton.onclick = () => {
                if (confirmationModal) {
                    confirmationModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        confirmationModal.classList.add('hidden');
                        confirmationModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            };
        }

        if (confirmationModal) {
            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    confirmationModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        confirmationModal.classList.add('hidden');
                        confirmationModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            });
        }
    }

    function updatePendingMessages() {
        const pendingCount = document.getElementById('pending-count');
        const messagesButton = document.getElementById('messages-button');
        const messageModal = document.getElementById('message-modal');
        const messageModalTitle = document.getElementById('message-modal-title');
        const messageModalContent = document.getElementById('message-modal-content');
        const messageModalNavigate = document.getElementById('message-modal-navigate');
        const closeMessageModal = document.getElementById('close-message-modal');

        if (pendingCount) {
            pendingCount.textContent = pendingItems.length;
            if (pendingItems.length > 0) {
                pendingCount.classList.remove('hidden');
            } else {
                pendingCount.classList.add('hidden');
            }
        }

        if (messagesButton) {
            messagesButton.addEventListener('click', () => {
                if (pendingItems.length > 0) {
                    const item = pendingItems[0];
                    if (messageModalTitle) messageModalTitle.textContent = item.type.charAt(0).toUpperCase() + item.type.slice(1) + ' Notification';
                    if (messageModalContent) messageModalContent.textContent = item.message;
                    if (messageModalNavigate) {
                        messageModalNavigate.onclick = () => {
                            window.location.href = item.navigateUrl;
                        };
                    }
                    if (messageModal) {
                        messageModal.classList.remove('hidden');
                        messageModal.classList.add('modal-enter-active');
                        setTimeout(() => messageModal.classList.remove('modal-enter-active'), 200);
                    }
                }
            });
        }

        if (closeMessageModal) {
            closeMessageModal.addEventListener('click', () => {
                if (messageModal) {
                    messageModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        messageModal.classList.add('hidden');
                        messageModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            });
        }

        if (messageModal) {
            messageModal.addEventListener('click', (e) => {
                if (e.target === messageModal) {
                    messageModal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        messageModal.classList.add('hidden');
                        messageModal.classList.remove('modal-exit-active');
                    }, 200);
                }
            });
        }
    }

    const closeSuccessAlert = document.getElementById('close-success-alert');
    if (closeSuccessAlert) {
        closeSuccessAlert.addEventListener('click', () => {
            document.getElementById('success-alert').classList.add('hidden');
        });
    }

    const closeErrorAlert = document.getElementById('close-error-alert');
    if (closeErrorAlert) {
        closeErrorAlert.addEventListener('click', () => {
            document.getElementById('error-alert').classList.add('hidden');
        });
    }

    window.updateBookingStatus = updateBookingStatus;
    window.deleteBooking = deleteBooking;
    window.updateApplicationStatus = updateApplicationStatus;
    window.deleteApplication = deleteApplication;

    window.addEventListener('resize', () => {
        if (window.innerWidth < 640) {
            sidebar.classList.add('hidden');
            contentArea.classList.remove('ml-56');
        } else {
            sidebar.classList.remove('hidden');
            contentArea.classList.add('ml-56');
        }
    });

    if (window.innerWidth < 640) {
        sidebar.classList.add('hidden');
        contentArea.classList.remove('ml-56');
    } else {
        sidebar.classList.remove('hidden');
        contentArea.classList.add('ml-56');
    }

    // Run initial login state check after DOM is fully loaded
    document.addEventListener('DOMContentLoaded', initializeLoginState);
</script>
</body>
</html>